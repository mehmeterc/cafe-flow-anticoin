<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Cafe Flow - AntiCoin</title>
    <meta name="description" content="Cafe Flow - Earn and spend AntiCoins at your favorite cafes" />
    <meta name="author" content="Cafe Flow Team" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.ico" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://cafe-flow.vercel.app/" />
    <meta property="og:title" content="Cafe Flow - AntiCoin" />
    <meta property="og:description" content="Earn and spend AntiCoins at your favorite cafes" />
    <meta property="og:image" content="/og-image.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://cafe-flow.vercel.app/" />
    <meta name="twitter:title" content="Cafe Flow - AntiCoin" />
    <meta name="twitter:description" content="Earn and spend AntiCoins at your favorite cafes" />
    <meta name="twitter:image" content="/og-image.jpg" />

    <!-- PWA -->
    <meta name="theme-color" content="#ffffff" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Load polyfills before any other scripts -->    
    <script>
      console.log('Initializing polyfills');
      
      // Set up global window object
      window.global = window;
      
      // Define process
      window.process = {
        env: { NODE_ENV: 'production' },
        browser: true,
        version: '',
        nextTick: function(fn, ...args) { setTimeout(() => fn(...args), 0); },
        cwd: function() { return '/'; }
      };
      
      // Mock require function to prevent errors
      window.require = function(id) {
        console.log('require called for:', id);
        if (id === 'process') return window.process;
        if (id === 'buffer') return { Buffer: window.Buffer };
        return {};
      };
      
      // Define Buffer
      window.Buffer = {
        from: function(data, encoding) {
          if (typeof data === 'string') {
            if (encoding === 'base64') {
              try {
                const binary = atob(data);
                const bytes = new Uint8Array(binary.length);
                for (let i = 0; i < binary.length; i++) {
                  bytes[i] = binary.charCodeAt(i);
                }
                return bytes;
              } catch (e) {
                console.error('Base64 decode error:', e);
                return new Uint8Array(0);
              }
            }
            return new TextEncoder().encode(data);
          }
          return new Uint8Array(Array.isArray(data) ? data : 0);
        },
        isBuffer: function(obj) { return obj instanceof Uint8Array; },
        alloc: function(size) { return new Uint8Array(size); }
      };
      
      // Ensure React.createContext exists
      window.React = window.React || {};
      window.React.createContext = window.React.createContext || function(defaultValue) {
        console.log('Using polyfill for React.createContext');
        return {
          Provider: function(props) { return props.children; },
          Consumer: function(props) { return props.children(defaultValue); },
          displayName: 'PolyfillContext'
        };
      };

      // Log successful initialization
      console.log('Polyfills initialized!');
    </script>
    
    <!-- Load the comprehensive polyfill -->    
    <script src="/node-polyfill.js"></script>
  </head>

  <body>
    <noscript>
      <div style="padding: 1rem; text-align: center;">
        <h1>JavaScript is required</h1>
        <p>Please enable JavaScript to use this application.</p>
      </div>
    </noscript>
    
    <div id="root"></div>
    
    <!-- Load main script -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
