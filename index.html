<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Cafe Flow - AntiCoin</title>
    <meta name="description" content="Cafe Flow - Earn and spend AntiCoins at your favorite cafes" />
    <meta name="author" content="Cafe Flow Team" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.ico" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://cafe-flow.vercel.app/" />
    <meta property="og:title" content="Cafe Flow - AntiCoin" />
    <meta property="og:description" content="Earn and spend AntiCoins at your favorite cafes" />
    <meta property="og:image" content="/og-image.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://cafe-flow.vercel.app/" />
    <meta name="twitter:title" content="Cafe Flow - AntiCoin" />
    <meta name="twitter:description" content="Earn and spend AntiCoins at your favorite cafes" />
    <meta name="twitter:image" content="/og-image.jpg" />

    <!-- PWA -->
    <meta name="theme-color" content="#ffffff" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Buffer polyfill -->
    <script>
      // Set up process.env for the app
      window.process = {
        env: { NODE_ENV: 'production' },
        browser: true,
        version: '',
        nextTick: (fn, ...args) => Promise.resolve().then(() => fn(...args))
      };

      // Load Buffer polyfill
      (function() {
        // Only set if not already defined
        if (typeof window.Buffer === 'undefined') {
          try {
            // Try to use the browser's TextEncoder/TextDecoder for Buffer if available
            if (typeof TextEncoder !== 'undefined' && typeof TextDecoder !== 'undefined') {
              const encoder = new TextEncoder();
              const decoder = new TextDecoder();
              
              window.Buffer = {
                from: (str, encoding) => {
                  if (encoding === 'base64') {
                    const binaryString = atob(str);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) {
                      bytes[i] = binaryString.charCodeAt(i);
                    }
                    return bytes;
                  }
                  return encoder.encode(str).buffer;
                },
                toString: (buf, encoding) => {
                  if (encoding === 'base64') {
                    let binary = '';
                    const bytes = new Uint8Array(buf);
                    for (let i = 0; i < bytes.byteLength; i++) {
                      binary += String.fromCharCode(bytes[i]);
                    }
                    return btoa(binary);
                  }
                  return decoder.decode(new Uint8Array(buf));
                },
                isBuffer: (obj) => {
                  return obj instanceof ArrayBuffer || 
                         obj instanceof Uint8Array ||
                         (obj && typeof obj === 'object' && 
                          typeof obj.length === 'number' &&
                          obj.constructor.name === 'Uint8Array');
                }
              };
            } else {
              // Fallback to empty Buffer implementation
              console.warn('TextEncoder/TextDecoder not available, using limited Buffer polyfill');
              window.Buffer = {
                from: () => new Uint8Array(0),
                toString: () => '',
                isBuffer: () => false
              };
            }
          } catch (e) {
            console.error('Failed to initialize Buffer polyfill:', e);
            window.Buffer = {
              from: () => new Uint8Array(0),
              toString: () => '',
              isBuffer: () => false
            };
          }
        }
      })();
    </script>
  </head>

  <body>
    <noscript>
      <div style="padding: 1rem; text-align: center;">
        <h1>JavaScript is required</h1>
        <p>Please enable JavaScript to use this application.</p>
      </div>
    </noscript>
    
    <div id="root"></div>
    
    <!-- Load main script -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
